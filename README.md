# YAML ↔ .env Converter

A comprehensive bidirectional tool for converting between YAML configuration files and .env format with multiple interfaces and advanced features.

## 🚀 Features

- **🔄 Bidirectional Conversion**: Convert YAML to .env AND .env to YAML
- **Multiple Interfaces**: Command-line (Node.js, Batch, PowerShell) and Web-based converter
- **Smart YAML Processing**: Handles Kubernetes-style env arrays and regular YAML key-value pairs
- **Kubernetes Array Format**: Convert .env files to Kubernetes-style name/value array format
- **Nested Object Support**: Automatically flattens nested objects with underscore notation (YAML→ENV) or creates nested structures (ENV→YAML)
- **Intelligent Value Handling**: Auto-quotes values with spaces or special characters
- **Watch Mode**: Auto-converts files when changes are detected
- **Backup Creation**: Safely backup existing files before conversion
- **Preview Mode**: See generated output before writing to file
- **Cross-Platform**: Works on Windows, macOS, and Linux

## 📋 Prerequisites

- **Node.js** (version 14 or higher)
- **npm** (comes with Node.js)

### Check if Node.js is installed:
```bash
node --version
npm --version
```

If not installed, download from [nodejs.org](https://nodejs.org/)

## 🛠️ Installation

### 1. Clone or Download the Project
```bash
git clone <repository-url>
cd yaml-to-env
```

### 2. Install Dependencies
```bash
npm install
```

This will install:
- `js-yaml` - YAML parser for Node.js

### 3. Verify Installation
```bash
node convert-yaml-to-env.js --help
```

## 📦 NPM Scripts

For convenience, several npm scripts are available:

### YAML to .env Scripts
```bash
npm start                # Same as npm run convert
npm run convert          # Basic conversion (uses default files)
npm run help             # Show help for yaml-to-env converter
npm run test             # Test conversion with preview
npm run watch            # Watch mode for auto-conversion
npm run backup           # Convert with backup creation
```

### .env to YAML Scripts
```bash
npm run env:to-yaml               # Basic env-to-yaml conversion
npm run env:to-yaml:help          # Show help for env-to-yaml converter
npm run env:to-yaml:test          # Test env-to-yaml with preview
npm run env:to-yaml:nested        # Test with nested output structure
```

## 🎯 Quick Start

### YAML to .env Conversion

1. **Create a sample YAML file** (`secrets.yaml`):
```yaml
# Regular key-value pairs
DATABASE_URL: "postgresql://user:pass@localhost:5432/db"
API_KEY: "your-secret-api-key"
DEBUG: true
PORT: 3000

# Nested configuration
database:
  host: localhost
  port: 5432
  name: myapp
  
# Kubernetes-style env array
env:
  - name: REDIS_URL
    value: "redis://localhost:6379"
  - name: JWT_SECRET
    value: "super-secret-key"
```

2. **Convert to .env format**:
```bash
node convert-yaml-to-env.js secrets.yaml .env
```

3. **Generated .env file**:
```bash
# Generated from secrets.yaml on 2025-07-08T10:30:00.000Z
# Auto-generated by convert-yaml-to-env.js

DATABASE_URL="postgresql://user:pass@localhost:5432/db"
API_KEY="your-secret-api-key"
DEBUG=true
PORT=3000
DATABASE_HOST=localhost
DATABASE_PORT=5432
DATABASE_NAME=myapp
REDIS_URL="redis://localhost:6379"
JWT_SECRET="super-secret-key"
```

### .env to YAML Conversion

1. **Create or use existing .env file**:
```bash
# Example .env file
APP_NAME="My Application"
DEBUG=true
PORT=3000
DATABASE_HOST=localhost
DATABASE_PORT=5432
API_KEY="your-secret-key"
```

2. **Convert to YAML format**:
```bash
node convert-env-to-yaml.js .env config.yaml
```

3. **Generated YAML file**:
```yaml
# Generated from .env on 2025-07-08T10:30:00.000Z
# Auto-generated by convert-env-to-yaml.js

APP_NAME: My Application
DEBUG: true
PORT: 3000
DATABASE_HOST: localhost
DATABASE_PORT: 5432
API_KEY: your-secret-key
```

4. **With nested structure** (using `--nested` flag):
```bash
node convert-env-to-yaml.js .env config.yaml --nested
```
```yaml
app:
  name: My Application
DEBUG: true
PORT: 3000
database:
  host: localhost
  port: 5432
api:
  key: your-secret-key
```

5. **Kubernetes-style array format** (using `--k8s-array` flag):
```bash
node convert-env-to-yaml.js .env config.yaml --k8s-array
```
```yaml
- name: "APP_NAME"
  value: "My Application"
- name: "DEBUG"
  value: "true"
- name: "PORT"
  value: "3000"
- name: "DATABASE_HOST"
  value: "localhost"
- name: "DATABASE_PORT"
  value: "5432"
- name: "API_KEY"
  value: "your-secret-key"
```

## 🔧 Usage Options

### YAML to .env Conversion

#### Node.js Script
```bash
# Basic conversion
node convert-yaml-to-env.js input.yaml output.env

# With preview
node convert-yaml-to-env.js input.yaml output.env --preview

# With backup
node convert-yaml-to-env.js input.yaml output.env --backup

# Watch mode (auto-convert on file changes)
node convert-yaml-to-env.js input.yaml output.env --watch

# Verbose error output
node convert-yaml-to-env.js input.yaml output.env --verbose

# Show help
node convert-yaml-to-env.js --help
```

#### Windows Batch File
```batch
REM Basic usage
yaml-to-env.bat secrets.yaml .env

REM With options
yaml-to-env.bat secrets.yaml .env --preview --backup

REM Show help
yaml-to-env.bat --help
```

#### PowerShell (Windows)
```powershell
# Basic usage
.\convert-yaml-to-env.ps1 secrets.yaml .env

# With options
.\convert-yaml-to-env.ps1 secrets.yaml .env -Preview -Backup
```

### .env to YAML Conversion

#### Node.js Script
```bash
# Basic conversion
node convert-env-to-yaml.js input.env output.yaml

# With preview
node convert-env-to-yaml.js input.env output.yaml --preview

# With nested structure
node convert-env-to-yaml.js input.env output.yaml --nested

# With sorted keys
node convert-env-to-yaml.js input.env output.yaml --sort

# Kubernetes-style array format
node convert-env-to-yaml.js input.env output.yaml --k8s-array

# With backup
node convert-env-to-yaml.js input.env output.yaml --backup

# Combined options
node convert-env-to-yaml.js input.env output.yaml --nested --sort --preview

# Kubernetes array with sorted keys
node convert-env-to-yaml.js input.env output.yaml --k8s-array --sort --preview

# Show help
node convert-env-to-yaml.js --help
```

#### Windows Batch File
```batch
REM Basic usage
env-to-yaml.bat .env config.yaml

REM With options
env-to-yaml.bat .env config.yaml --nested --preview

REM Show help
env-to-yaml.bat --help
```

#### PowerShell (Windows)
```powershell
# Basic usage
.\convert-env-to-yaml.ps1 -InputFile .env -OutputFile config.yaml

# With options
.\convert-env-to-yaml.ps1 -InputFile .env -OutputFile config.yaml -Nested -Preview -Sort
```

### Web Interface

1. **Open the HTML converter**:
```bash
# Open yaml-to-env-converter.html in your browser
start yaml-to-env-converter.html  # Windows
open yaml-to-env-converter.html   # macOS
xdg-open yaml-to-env-converter.html # Linux
```

2. **Use the web interface**:
   - Paste your YAML content
   - Click "Convert to .env"
   - Copy the generated .env output

## 📝 Advanced Examples

### Example 1: Kubernetes ConfigMap
```yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: app-config
data:
  DATABASE_URL: "postgresql://localhost:5432/myapp"
  REDIS_URL: "redis://localhost:6379"
  LOG_LEVEL: "info"
```

### Example 2: Docker Compose Environment
```yaml
version: '3.8'
services:
  app:
    environment:
      - NODE_ENV=production
      - PORT=3000
      - DATABASE_URL=postgresql://user:pass@db:5432/app
```

### Example 3: Nested Configuration
```yaml
app:
  name: "My Application"
  version: "1.0.0"
  
server:
  host: "0.0.0.0"
  port: 3000
  ssl:
    enabled: true
    cert_path: "/path/to/cert.pem"
    key_path: "/path/to/key.pem"

database:
  primary:
    host: "db1.example.com"
    port: 5432
    database: "myapp"
  replica:
    host: "db2.example.com"
    port: 5432
    database: "myapp"
```

**Generated .env**:
```bash
APP_NAME="My Application"
APP_VERSION="1.0.0"
SERVER_HOST="0.0.0.0"
SERVER_PORT=3000
SERVER_SSL_ENABLED=true
SERVER_SSL_CERT_PATH="/path/to/cert.pem"
SERVER_SSL_KEY_PATH="/path/to/key.pem"
DATABASE_PRIMARY_HOST="db1.example.com"
DATABASE_PRIMARY_PORT=5432
DATABASE_PRIMARY_DATABASE="myapp"
DATABASE_REPLICA_HOST="db2.example.com"
DATABASE_REPLICA_PORT=5432
DATABASE_REPLICA_DATABASE="myapp"
```

## 🔍 Troubleshooting

### Common Issues

1. **"Node.js is not installed"**
   - Install Node.js from [nodejs.org](https://nodejs.org/)
   - Restart your terminal/command prompt

2. **"convert-yaml-to-env.js not found"**
   - Make sure you're in the project directory
   - Check that the file exists: `dir convert-yaml-to-env.js` (Windows) or `ls convert-yaml-to-env.js` (macOS/Linux)

3. **"Input file not found"**
   - Verify the YAML file path is correct
   - Use absolute paths if needed: `C:\path\to\your\file.yaml`

4. **"Invalid YAML"**
   - Check your YAML syntax using an online YAML validator
   - Ensure proper indentation (spaces, not tabs)
   - Quote strings with special characters

5. **Permission errors**
   - Run as administrator (Windows) or with `sudo` (macOS/Linux)
   - Check file permissions

### Debug Mode
```bash
# Get detailed error information
node convert-yaml-to-env.js input.yaml output.env --verbose
```

## 🧪 Testing

### Test with Sample Files

1. **Create test files**:
```bash
# Create a simple test YAML
echo "TEST_VAR: hello world" > test.yaml
echo "ANOTHER_VAR: 12345" >> test.yaml

# Convert it
node convert-yaml-to-env.js test.yaml test.env --preview

# Check the output
type test.env  # Windows
cat test.env   # macOS/Linux
```

2. **Test watch mode**:
```bash
# Start watch mode
node convert-yaml-to-env.js test.yaml test.env --watch

# In another terminal, modify test.yaml
echo "NEW_VAR: added" >> test.yaml
# The conversion will happen automatically
```

## 📁 Project Structure

```
yaml-to-env/
├── convert-yaml-to-env.js      # Main Node.js converter
├── yaml-to-env.bat             # Windows batch wrapper
├── convert-yaml-to-env.ps1     # PowerShell script
├── yaml-to-env-converter.html  # Web interface
├── package.json                # Node.js dependencies
├── README.md                   # This documentation
└── examples/                   # Example files (optional)
    ├── secrets.yaml
    ├── kubernetes-config.yaml
    └── docker-compose.yaml
```

## 🤝 Contributing

1. Fork the repository
2. Create a feature branch: `git checkout -b feature-name`
3. Make your changes
4. Test thoroughly
5. Submit a pull request

## 📄 License

This project is open source. Feel free to use, modify, and distribute.

## 📞 Support

If you encounter any issues:
1. Check the troubleshooting section above
2. Review the examples for proper YAML formatting
3. Use `--verbose` flag for detailed error messages
4. Open an issue with your specific use case

---

**Happy Converting! 🎉**
